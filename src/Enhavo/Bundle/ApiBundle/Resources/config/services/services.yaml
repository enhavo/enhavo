services:
    Enhavo\Bundle\ApiBundle\Controller\DocumentationController:
        arguments:
            - '@Enhavo\Bundle\ApiBundle\Documentation\DocumentationCollector'
        calls:
            - [setContainer, ['@Psr\Container\ContainerInterface']]
        tags:
            - { name: controller.service_arguments }

    Enhavo\Bundle\ApiBundle\EventListener\EndpointRouteListener:
        arguments:
            - '@Enhavo\Component\Type\FactoryInterface[Endpoint]'
        tags:
            - { name: kernel.event_listener, event: kernel.request, priority: -100 }

    Enhavo\Bundle\ApiBundle\Routing\Loader\EndpointDirectoryLoader:
        arguments:
            - '@file_locator'
            - '@Enhavo\Bundle\ApiBundle\Routing\Loader\AnnotatedRouteEndpointLoader'
        tags:
            - { name: routing.loader }

    Enhavo\Bundle\ApiBundle\Routing\Loader\AnnotatedRouteEndpointLoader:
        arguments:
            - '@annotation_reader'

    Enhavo\Bundle\ApiBundle\Documentation\DocumentationCollector:
        arguments:
            - '@router'
            - '%enhavo_api.documentation%'
        calls:
            - [setEndpointFactory, ['@Enhavo\Component\Type\FactoryInterface[Endpoint]']]

    enhavo_api.normalizer:
        alias: Enhavo\Bundle\ApiBundle\Normalizer\ChainNormalizer

    Enhavo\Bundle\ApiBundle\Normalizer\ChainNormalizer:
        calls:
            - [addNormalizer, ['@serializer', 5]]
            - [addNormalizer, ['@Enhavo\Bundle\ApiBundle\Normalizer\DataNormalizer', 20]]

    Enhavo\Bundle\ApiBundle\Normalizer\DataNormalizer:
        arguments:
            - '@serializer'