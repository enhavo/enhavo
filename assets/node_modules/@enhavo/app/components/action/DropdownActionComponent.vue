<template>
    <div class="action">
        <div @click="toggleOpen()">
            <div class="action-icon">
                <i v-bind:class="['icon', data.icon]" aria-hidden="true"></i>
            </div>
            <div class="label">{{ data.label }}</div>
        </div>
        <ul class="dropdown-action-list" v-if="open" @click="itemClick()">
            <template v-for="action in data.items">
                <component class="action-container" v-bind:is="action.component" v-bind:data="action" :data-action="action.key"></component>
            </template>
        </ul>
    </div>
</template>

<script setup lang="ts">
import {onMounted, onUnmounted} from 'vue'
import DropdownAction from "@enhavo/app/action/model/DropdownAction";

const props = defineProps<{
    data: DropdownAction
}>()

const open: boolean = false;

function toggleOpen()
{
    this.open = !this.open;
}

function itemClick()
{
    if (this.data.closeAfter) {
        this.open = false;
    }
}

// Close when clicked outside
function close(e: Event)
{
    if (!this.$el.contains(<Node>e.target)) {
        this.open = false;
    }
}

onMounted(() => {
    document.addEventListener('click', close)
});

onUnmounted(() => {
    document.removeEventListener('click', close)
});
</script>
