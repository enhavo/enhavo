<template>
    <div class="app-view">
        <view-view></view-view>
        <flash-messages></flash-messages>
        <action-bar></action-bar>

        <div class="tab-header" v-if="$MediaLibrary.data.tabs.length > 1">
            <template v-for="tab in $MediaLibrary.data.tabs">
                <tab-head v-bind:selected="tab.id === $MediaLibrary.data.activeTab" v-bind:tab="tab" @change="changeTab(tab)"></tab-head>
            </template>
        </div>

        <div class="MediaLibrary-overlay" data-MediaLibrary-overlay>
            <div class="close-MediaLibrary-overlay button-icon icon-cross" data-MediaLibrary-close></div>
            <div class="inner-content" data-scroll-container>
                <div class="tag-list">
                    <div class="headline"><i class="icon icon-folder_open"></i> Tags</div>
                    <tag-list
                        :tags="$MediaLibrary.data.tags"
                    ></tag-list>
                </div>

                <div class="result-search">
                    <div class="search">
                        <input ref="searchInput" v-model="$MediaLibrary.data.searchString" type="text" data-MediaLibrary-search />
                        <span @click="clearSearch()" class="coconut-search-reset"><i class="icon icon-close"></i></span>
                        <span @click="search()" class="coconut-search-submit"><i class="icon icon-search"></i></span>
                    </div>
                    <ul v-if="!$MediaLibrary.data.loading" class="images" data-MediaLibrary-result>
                        <image-component
                            v-for="item of $MediaLibrary.data.items"
                            :item="item"
                            :data="$MediaLibrary.data"
                            v-bind:key="item.id"
                        ></image-component>
                    </ul>
                    <div class="lds-ellipsis" v-else><div></div><div></div><div></div><div></div></div>
                </div>
            </div>
        </div>
    </div>
</template>

<script lang="ts">
    import * as $ from 'jquery';
    import { Vue, Component, Prop, Watch } from "vue-property-decorator";
    import '@enhavo/app/assets/styles/view.scss';
    import ActionBar from "@enhavo/app/action/components/ActionBar.vue";
    import FlashMessages from "@enhavo/app/flash-message/components/FlashMessages.vue";
    import ViewComponent from "@enhavo/app/view/components/ViewComponent.vue";
    import TagListComponent from "@enhavo/media-library/components/TagListComponent.vue";
    import TagComponent from "@enhavo/media-library/components/TagComponent.vue";
    import ImageComponent from "@enhavo/media-library/components/ImageComponent.vue";
    import TabHead from "@enhavo/media-library/components/TabHead.vue";

    Vue.component('tag-component', TagComponent);
    Vue.component('tag-list', TagListComponent);
    Vue.component('image-component', ImageComponent);

    @Component({
        components: {
            ImageComponent,
            'flash-messages': FlashMessages,
            'action-bar': ActionBar,
            'view-view': ViewComponent,
            'tab-head': TabHead
        }
    })

    export default class ApplicationComponent extends Vue
    {
        @Prop()
        tags: Array<any>;

        @Watch('searchString')
        onChangeSearchString(val:string)
        {
          this.$MediaLibrary.data.searchString = val;
        }

        getAddLabel()
        {
            if(this.$MediaLibrary.data.multiple){
                return "Ausgew채hlte Bilder hinzuf체gen";
            } else {
                return "Ausgew채hltes Bild hinzuf체gen";
            }
        }

        search()
        {
            this.$MediaLibrary.search();
        }

        clearSearch()
        {
            this.$MediaLibrary.clearSearch()

        }

        changeTab(tab)
        {
            this.$MediaLibrary.changeTab(tab);
        }

        created()
        {
            window.addEventListener('keydown', (e) => {
                if (e.key == 'Enter') {
                    let isSearchFocus = $(this.$refs.searchInput).is(':focus');
                    if(isSearchFocus){
                        this.search();
                    }
                }
            });
        }
    }
</script>
