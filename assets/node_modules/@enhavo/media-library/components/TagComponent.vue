<template>
    <li>
        <div @click="clickTag()" class="tag-name" :class="{'has-children': tag.children.length > 0, 'active': opened}"><span v-html="renderIcon()"></span>{{ tag.title }}</div>
        <tag-list
            v-if="tag.children.length > 0"
            v-show="opened"
            :tags="tag.children"
            :parents="createParents()"
        ></tag-list>
    </li>
</template>

<script lang="ts">
    import { Vue, Component, Prop } from "vue-property-decorator";
    import EventHub from "../EventHub"
    import {Tag} from "../Data";

    @Component({})
    export default class TagComponent extends Vue
    {
        name: 'tag-component';

        @Prop()
        tag: Tag;

        @Prop()
        parents: Array<number>;

        opened = false;

        clickTag()
        {
            this.$MediaLibrary.setActiveTag(this.tag.MediaLibraryId);
            EventHub.$emit('openCategories', this.getParentsAndSelf());
        }

        mounted()
        {
            let self = this;
            EventHub.$on('openCategories', function (array:Array<number>) {
                if(array.includes(parseInt(self.tag.MediaLibraryId))){
                    self.opened = true;
                } else {
                    self.opened = false;
                }
            });
        }

        getParentsAndSelf()
        {
            let entries = this.parents.slice(0);
            entries.push(parseInt(this.tag.MediaLibraryId));
            return entries;
        }

        renderIcon()
        {
            if(this.tag.children.length === 0){
                return '';
            }

            if(this.opened){
                return '<i class="icon icon-keyboard_arrow_down"></i> ';
            }
            return '<i class="icon icon-keyboard_arrow_right"></i> '
        }

        createParents()
        {
            let parents = this.parents.slice(0);
            parents.push(parseInt(this.tag.MediaLibraryId));
            return parents;
        }
    }
</script>
